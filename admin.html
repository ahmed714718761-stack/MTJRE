<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… MTJRE</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --main: #0055ff; --red: #ff4757; }
        body { font-family: 'Cairo'; background: #f4f7fa; margin: 0; }
        .tabs { display: flex; background: #fff; overflow-x: auto; sticky; top: 0; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .tab { flex: 1; padding: 15px; text-align: center; cursor: pointer; min-width: 100px; font-weight: bold; }
        .tab.active { border-bottom: 4px solid var(--main); color: var(--main); }
        .container { max-width: 900px; margin: 20px auto; padding: 0 15px; }
        .card { display: none; background: #fff; padding: 20px; border-radius: 12px; }
        .card.active { display: block; }
        input, select, textarea { width: 100%; padding: 10px; margin: 8px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-family: 'Cairo'; }
        button { width: 100%; padding: 12px; background: var(--main); color: #fff; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .list-item { background: #f9f9f9; padding: 10px; border-radius: 8px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; }
        .del { background: var(--red); width: auto; padding: 5px 10px; font-size: 11px; }
    </style>
</head>
<body>

<div class="tabs">
    <div class="tab active" onclick="showTab('orders', this)">Ø§Ù„Ø·Ù„Ø¨Ø§Øª</div>
    <div class="tab" onclick="showTab('products', this)">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</div>
    <div class="tab" onclick="showTab('users', this)">Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</div>
    <div class="tab" onclick="showTab('settings', this)">Ø§Ù„Ø§Ø¹Ø¯Ø§Ø¯Ø§Øª</div>
</div>

<div class="container">
    <div id="orders" class="card active"><h3>ğŸ“‹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙˆØ§Ø±Ø¯Ø©</h3><div id="orderList"></div></div>
    
    <div id="products" class="card">
        <h3>ğŸ“¦ Ø£Ø¶Ù Ù…Ù†ØªØ¬</h3>
        <input type="file" id="pImg">
        <input type="text" id="pCode" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…Ù†ØªØ¬">
        <input type="text" id="pName" placeholder="Ø§Ù„Ø§Ø³Ù…">
        <input type="number" id="pNew" placeholder="Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯">
        <input type="number" id="pOld" placeholder="Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù‚Ø¯ÙŠÙ…">
        <textarea id="pDesc" placeholder="Ø§Ù„ÙˆØµÙ"></textarea>
        <button onclick="saveP()">Ø­ÙØ¸</button>
        <div id="pList" style="margin-top:20px"></div>
    </div>

    <div id="users" class="card"><h3>ğŸ‘¥ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ†</h3><div id="userList"></div></div>

    <div id="settings" class="card">
        <h3>âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØ¬Ø±</h3>
        <input type="text" id="sLogo" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„Ù„ÙˆØ¬Ùˆ">
        <input type="text" id="sPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨">
        <input type="text" id="sAddr" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†">
        <input type="text" id="sNews" placeholder="Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø®Ø¨Ø§Ø±">
        <button onclick="updateSettings()">ØªØ­Ø¯ÙŠØ«</button>
    </div>
</div>

<script>
    const SCRIPT_URL = 'Ø¶Ø¹_Ø±Ø§Ø¨Ø·_Ø§Ù„Ø³ÙƒØ±Ø¨Øª_Ù‡Ù†Ø§';

    async function load() {
        const r = await fetch(SCRIPT_URL); const d = await r.json();
        // Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
        document.getElementById('orderList').innerHTML = d.orders.slice(1).reverse().map(o => `
            <div class="list-item"><div><b>${o[0]}</b> - ${o[2]}<br><small>${o[5]}</small></div><button class="del" onclick="del('Ø§Ù„Ø·Ù„Ø¨Ø§Øª','${o[0]}')">Ø­Ø°Ù</button></div>`).join('');
        // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
        document.getElementById('pList').innerHTML = d.products.slice(1).map(p => `
            <div class="list-item"><span>${p[1]}</span><button class="del" onclick="del('Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª','${p[0]}')">Ø­Ø°Ù</button></div>`).join('');
        // Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
        document.getElementById('userList').innerHTML = d.users.slice(1).map(u => `
            <div class="list-item"><span>${u[1]} (${u[2]})</span></div>`).join('');
        // Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
        document.getElementById('sLogo').value=d.settings[1][1]; document.getElementById('sPhone').value=d.settings[3][1];
        document.getElementById('sAddr').value=d.settings[4][1]; document.getElementById('sNews').value=d.settings[7][1];
    }

    async function saveP() {
        const f = document.getElementById('pImg').files[0];
        const reader = new FileReader();
        reader.onloadend = async () => {
            await send({ action:"add", sheetName:"Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª", image:reader.result.split(',')[1], mimeType:f.type, fileName:f.name,
                rowData:[Date.now(), document.getElementById('pName').value, document.getElementById('pNew').value, "Ø¹Ø§Ù…", "AUTO_IMAGE", "Ù…ØªØ§Ø­", "0", document.getElementById('pDesc').value, document.getElementById('pOld').value, document.getElementById('pCode').value] });
        }; reader.readAsDataURL(f);
    }

    async function updateSettings() {
        await send({ action:"update_settings", sheetName:"Ø§Ù„Ø§Ø¹Ø¯Ø§Ø¯Ø§Øª", logo:document.getElementById('sLogo').value, phone:document.getElementById('sPhone').value, address:document.getElementById('sAddr').value, news:document.getElementById('sNews').value });
    }

    async function del(s, id) { if(confirm("Ø­Ø°ÙØŸ")) await send({action:"delete", sheetName:s, id:id}); }
    async function send(p) { await fetch(SCRIPT_URL,{method:'POST', body:JSON.stringify(p)}); location.reload(); }
    function showTab(id, b) { document.querySelectorAll('.card').forEach(c=>c.classList.remove('active')); document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active')); document.getElementById(id).classList.add('active'); b.classList.add('active'); }
    window.onload = load;
</script>
</body>
</html>
